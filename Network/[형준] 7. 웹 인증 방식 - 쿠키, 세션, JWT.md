# 인증 방식(로그인 방식) - Cookie, Session, Token
웹 어플리케이션에서 사용하는 인증 방식은 Cookie, Session, Token(JWT) 방식이 있다.

세 가지 인증 방식을 사용하기 전에 알아야 할 개념에 대해 설명하겠다.

### 인증 / 인가
로그인 기능을 구현하기 위해 크게 두 가지 개념을 알아야한다.

- **인증(Authentication)**
  - 특정 서비스에 일정한 권한이 주어진 사용자임을 아이디와 패스워드를 통해 확인받는 과정
  - 즉, 로그인이라고 생각하면 됨
- **인가(Authorization)**
  - 한 번 인증(로그인)을 받은 사용자가 서비스의 다양한 기능을 사용할 때마다 서버가 사용자가 인증 받았음을 확인하고 기능을 허용해주는 것

즉, 인증은 로그인 하는 것이고 인가는 로그인 후 사이트의 기능을 사용하는 것(블로그 글 작성, 수정, 삭제)을 의미한다.

웹 어플리케이션에서 인증과 인가를 사용하는 이유는 HTTP 프로토콜이 비연결성(Connectionless), 무상태(Stateless)의 특징을 지니기 때문이다.
따라서 한 번 인증(로그인)을 받았더라도 Stateless 상태이기 때문에 매 요청마다 인가를 받아야 하는 것이다.

## 쿠키 인증 방식
> [!NOTE]
> #### 쿠키란?
> 서버에서 생성하고 웹 브라우저에 저장되어 웹 브라우저와 서버 간의 정보 교환을 위해 사용되는 작은 데이터 파일

### 쿠키 사용 과정
- 사용자가 로그인을 하면 서버는 ID와 PASSWORD를 확인한 뒤 맞다면 쿠키를 발행하여 클라이언트에 응답한다.
- 클라이언트(브라우저)는 받은 쿠키를 웹 브라우저 내부에 저장하고 요청을 할 때마다 쿠키에 있는 로그인 정보를 함께 보낸다.
- 서버는 받은 로그인 정보(쿠키)를 확인하고 맞다면 요청 데이터와 함께 응답을 한다.

![alt text](./[형준]%20Image/image-5.png)

### 쿠키 방식 단점
- 사용자의 주요 정보를 매 요청마다 담아 보내기 때문에 보안에 취약하다.
  - 브라우저 내부에 쿠키가 저장되기 때문에 쿠키 정보를 쉽게 변경, 삭제할 수 있고 가로챌 수 있다.
- 쿠키 사이즈가 커질 수록 네트워크에 부담이 크다. 
- 쿠키는 용량 제한이 있어서 많은 정보를 담을 수 없다.

## 세션 인증 방식
> [!NOTE]
> #### 세션이란?
> 쿠키의 보안 문제 때문에 나온 방법으로 비밀번호 등 클라이언트의 민감한 정보를 브라우저가 아닌 서버에 저장하고 관리하는 방식

- 클라이언트가 로그인을 하면 서버 내부의 세션에 클라이언트 별로 유일한 세션 ID를 부여하고 저장한다.
- 이후 클라이언트가 요청을 보낼 때마다 세션 ID가 저장된 세션 쿠키를 함께 보내고 서버에서는 세션 ID 값을 보고 클라이언트를 식별하여 요청에 응답한다.

![alt text](./[형준]%20Image/image-6.png)

### 세션 방식 단점
- 쿠키 방식과 다르게 클라이언트의 주요 정보를 담고 있지 않고 세션 ID만 담고 있기 떄문에 주요 정보가 유출될 가능성은 없다.
  - 하지만 세션 ID를 탈취하여 클라이언트인척 위장해서 요청을 보낼 수 있다는 문제가 있다.
- 서버에 세션 저장소를 설치해야 하기 때문에 서버에 부하가 가해진다.

## 토큰 인증 방식
> [!NOTE]
> #### 토큰이란?
> 클라이언트가 서버에 접속(로그인)하면 인증되었다는 의미로 부여하는 토큰


- 클라이언트가 로그인을 하면 서버는 클라이언트에게 유일한 토큰을 발급한다.
- 클라이언트는 쿠키나 스토리지에 토큰을 저장하고, 서버에 요청할 때마다 요청 HTTP 헤더에 토큰을 포함시켜 보낸다.
- 요청을 받은 서버는 토큰을 통해 클라이언트를 검증하고 HTTP 헤더에 토큰을 담아 응답 메시지를 보낸다.

![alt text](./[형준]%20Image/image-7.png)

### 토큰 기반 인증 방식이 나온 이유
토큰 기반 인증 방식은 세션 기반 인증 방식의 문제점을 해결하기 위해 나왔다.

> [!TIP] 서버 기반 인증 방식의 문제점
> - 서버 내부에 세션 저장소를 설치하고 사용자 인증 정보를 저장 관리하는 방식
> - 클라이언트의 상태를 유지해놓고 사용하는 Stateful 방식이라서 사용자가 증가함에 따라 서버에 부하가 심해지는 문제 발생


### 토큰 방식 장점
세션 방식과 다르게 서버 내부에 사용자 정보를 저장하지 않고 토큰 내부에만 저장하여 DB 조회를 할 필요 없어서 서버의 부하를 최소화할 수 있다.

### 토큰 방식 단점
- 매 요청마다 토큰을 함께 보내야 하는데 세션, 쿠키에 비해 토큰 자체의 데이터가 커서 네트워크 부하가 심해질 수 있다.
- Payload 자체는 암호화되지 않기 때문에 클라이언트의 중요한 정보는 담을 수 없다.(ex. 비밀번호)
- 토큰을 탈취당하면 대처하기 어렵다.
  - 토큰 사용 시간 제한을 설정하는 방식으로 극복한다. 

## JWT(JSON Web Token) 토큰 인증 방식
> [!NOTE]
> #### JWT(JSON Web Token) 토큰이란?
> 인증에 필요한 JSON 정보들을 Base64 URL-safe Encode를 통해 인코딩하여 직렬화하여 암호화시킨 JSON 토큰이다.

- 토큰 내부에 위변조를 방지를 위한 개인키를 통한 전자서명이 들어가 있다.
- 클라이언트가 로그인을 하면 서버는 전자서명을 검증하는 과정을 통해 사용자를 확인하고 로그인 정보를 Payload에 담고, Secret Key를 사용해서 Access Token(JWT)을 발급하여 HTTP 헤더에 포함하여 클라이언트에게 보낸다.
- JWT를 전달 받은 클라이언트는 JWT 토큰을 쿠키나 세션에 저장한다.
- 이후 모든 요청에 JWT 토큰을 HTTP 헤더에 포함하여 서버에 요청 메시지를 보낸다.
- 요청 메시지를 받은 서버는 토큰의 Signature를 secret Key로 복호화한 후, 위변조 여부 및 유효기간을 검증하여 검증에 설공하면 응답한다.

![alt text](./[형준]%20Image/image-8.png)

### JWT(JSON Web Token) 방식 장점
- 인증 정보를 서버에 저장할 필요 없이 Stateless 방식으로 사용 가능하기 때문에 서버에 부하가 적다.
  - 동시 접속자가 많을 때 서버의 부하를 낮춘다.

### JWT(JSON Web Token) 방식 단점
- 구현 복잡도가 증가한다.
- JWT에 담는 내용이 커질수록 네트워크 부하가 심해진다.
- Payload는 암호화하지 않기 때문에 주요 정보를 담을 수 없다.
- Secret Key 유출 시 JWT 토큰 조작이 가능하다.


### 출처
https://velog.io/@kimdy0915/%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-JWT%EC%97%90-%EB%8C%80%ED%95%B4-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90
https://inpa.tistory.com/entry/WEB-%F0%9F%93%9A-JWTjson-web-token-%EB%9E%80-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC